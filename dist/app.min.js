function MyViewModel(){var e=this;e.searchButtonText=ko.observable("Show Me The Music!"),e.cityVal=ko.observable("Orlando"),e.venueVal=ko.observable(),e.events=ko.observableArray(),e.markers=ko.observableArray(),e.resultsInfo=ko.observable(!1),e.resultsList=ko.observable(!1),e.performerInfo=ko.observable(!1),e.currentEventName=ko.observable(),e.currentEventDate=ko.observable(),e.currentVenueName=ko.observable(),e.currentEventIndex=ko.observable(),e.currentPerformerID=ko.observable(),e.currentVenueAddress=ko.observable(),e.currentPerformerName=ko.observable(),e.currentPerformerURLs=ko.observableArray(),e.currentPerformerGenres=ko.observableArray(),e.currentPerformerVideos=ko.observableArray(),e.runSearch=function(){var r=e.cityVal();e.searchButtonText("Load More Events"),u++,v(r)},e.cleanSearch=function(){var r;e.cityVal()?(r=e.cityVal(),u=1,l=[],i=[],b(null),e.currentEventIndex(null),v(r)):alert("Enter a City")},e.displayResults=function(){e.resultsList(e.resultsList()?!1:!0)},e.displayEvent=function(){var r=this,t=r.eventIndex,a=r.performerIndex,s=r.performerID,u=i[t],c=l[t],v=c.eventPerformers[a];e.currentEventIndex(t),e.currentPerformerID(s),o?(o.close(),o=u.eventInfo):o=u.eventInfo,u.eventInfo.open(n,u),n.setCenter(u.position),e.currentEventDate(c.eventDate),e.currentEventName(c.eventTitle),e.currentVenueName(c.eventVenue.name),e.currentVenueAddress(c.eventVenue.address),e.currentPerformerName(v.performerName),I(s)},e.displayVenue=function(){var e=this,r=e.eventIndex,n=i[r];g(n)},e.filterVenues=function(){var r;if(e.clearFilter(),o&&o.close(),!e.venueVal())return null;r=e.venueVal().toLowerCase();var t=l,a=i;e.events([]),b(null),e.markers([]);for(var s,u,c=0,v=t.length;v>c;c++)s=t[c],u=s.eventVenue.name.toLowerCase(),r===u&&(e.events.push(s),e.markers.push(a[c]));b(n)},e.removeFilter=function(){e.venueVal(null),e.clearFilter()},e.clearFilter=function(){e.events(l),e.markers(i),b(null),b(n)},e.openPerformerInfo=function(){e.performerInfo(!0)},e.closePerformerInfo=function(){e.performerInfo(!1),c(),m(),b(n)};var r,n,o,t,a=28.4158,s=-81.2989,l=[],i=[],u=0;$(function(){$.ajaxSetup({error:function(e,r,n){console.log(e),alert("Something went wrong, and it's entirely your fault\nStatus: "+e.status+" - "+r+" "+n)}})});var c=function(){function e(){var e=n.getCenter();google.maps.event.trigger(n,"resize"),n.setCenter(e)}r=new google.maps.Geocoder;var o=new google.maps.LatLng(a,s),t={zoom:10,center:o,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.TERRAIN]},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},panControl:!1};n=new google.maps.Map(document.getElementById("map-canvas"),t),google.maps.event.addDomListener(n,"idle",function(){e()}),google.maps.event.addDomListener(window,"resize",function(){e()})},v=function(o){e.cityVal(null),r.geocode({address:o},function(e,r){if(r===google.maps.GeocoderStatus.OK){var o=e[0].geometry.location;a=o.lat(),s=o.lng(),n.setCenter(o),m()}else alert("Geocode was not successful for the following reason: "+r);p(a,s)})},m=function(){var e=new google.maps.LatLng(a,s);t&&t.setMap(null),t=new google.maps.Marker({map:n,position:e,icon:"images/blue-dot.png"})},p=function(e,r){function n(e){f(e)}var o=["concert","music_festival","classical","classical_opera","classical_vocal","classical_orchestral_instrumental"],t={per_page:50,"taxonomies.name":o,lat:e,lon:r,page:u};$.ajax({url:"http://api.seatgeek.com/2/events",dataType:"json",data:t,traditional:!0,success:n})},f=function(r){for(var n=function(e){var r=e.split("T"),n=r[0].split("-"),o=r[1].split(":");o[0]=parseInt(o[0]),o[0]>=13?(o[0]-=12,o[3]="p.m."):o[3]="a.m.";var t=n[1]+"/"+n[2]+"/"+n[0],a=o[0]+":"+o[1]+" "+o[3],s=t+" - "+a;return s},o=0,t=r.events.length;t>o;o++){var a=r.events[o],s=a.venue,i=n(a.datetime_local),c={eventTitle:a.title,eventType:a.type,eventURL:a.url,eventIndex:o};c.eventDate=a.date_tbd?i+" (Date estimated)":a.time_tbd?i+" (Exact time not set)":i,c.eventPerformers=[];for(var v,m=0,p=a.performers.length;p>m;m++)v={},v.performerName=a.performers[m].name,v.performerImgURL=a.performers[m].image,v.eventIndex=o+(50*u-50),v.performerIndex=m,v.performerID=a.performers[m].id,c.eventPerformers.push(v);c.eventVenue={name:s.name,address:s.address+", "+s.display_location+", "+s.postal_code,lat:s.location.lat,lng:s.location.lon},l.push(c)}e.events(l),e.resultsInfo(!0),d(l)},d=function(r){for(var o,t,a,s,l=function(e){google.maps.event.addListener(e,"click",function(){var e=this;g(e)})},c=0+(50*u-50),v=r.length;v>c;c++)t=r[c].eventVenue.lat,a=r[c].eventVenue.lng,s=new google.maps.LatLng(t,a),o=new google.maps.Marker({map:n,position:s,icon:"images/green-dot.png"}),o.eventInfo=new google.maps.InfoWindow({content:"<div id='content'><h1 id='content_header'>"+r[c].eventTitle+"</h1><button onclick=vm.openPerformerInfo()>Get Info</button>"}),o.venueInfo=new google.maps.InfoWindow({content:"<div id='content'><h1 id='content_header'>"+r[c].eventVenue.name+"</h1>"}),l(o),i.push(o);e.markers(i)},g=function(e){o?(o.close(),o=e.venueInfo):o=e.venueInfo,e.venueInfo.open(n,e),n.setCenter(e.position)},b=function(r){for(var n=0;n<e.markers().length;n++)e.markers()[n].setMap(r)},I=function(e){var r="2QHXFMFAW2PDSCYKW",n="seatgeek:artist:"+e,o="http://developer.echonest.com/api/v4/artist/profile?",t={api_key:r,id:n,format:"json",bucket:["urls","video","genre"]};$.ajax({url:o,data:t,success:y,dataType:"json",traditional:!0})},y=function(r){if(e.currentPerformerURLs([]),e.currentPerformerGenres([]),e.currentPerformerVideos([]),0===r.response.status.code){var n=r.response.artist,o=n.urls,t=n.genres,a=n.video;e.currentPerformerURLs().push(o),e.currentPerformerGenres(t),e.currentPerformerVideos(a)}};google.maps.event.addDomListener(window,"load",c)}var vm=new MyViewModel;ko.applyBindings(vm);
function MyViewModel(){var e=this;e.searchButtonText=ko.observable("Show Me The Music!"),e.cityVal=ko.observable("Orlando"),e.venueVal=ko.observable(),e.events=ko.observableArray(),e.markers=ko.observableArray(),e.resultsInfo=ko.observable(!1),e.performerInfo=ko.observable(!1),e.currentEventName=ko.observable(),e.currentEventDate=ko.observable(),e.currentVenueName=ko.observable(),e.currentEventIndex=ko.observable(),e.currentPerformerID=ko.observable(),e.currentVenueAddress=ko.observable(),e.currentPerformerName=ko.observable(),e.currentPerformerURLs=ko.observableArray(),e.currentPerformerGenres=ko.observableArray(),e.currentPerformerVideos=ko.observableArray(),e.runSearch=function(){var r=e.cityVal();e.searchButtonText("Load More Events"),c++,m(r)},e.cleanSearch=function(){var r=e.cityVal();c=1,l=[],i=[],b(null),e.currentEventIndex(null),m(r)},e.displayEvent=function(){var r=this.eventIndex,t=this.performerIndex,a=this.performerID,s=i[r],c=l[r],u=c.eventPerformers[t];e.currentEventIndex(r),e.currentPerformerID(a),o?(o.close(),o=s.eventInfo):o=s.eventInfo,s.eventInfo.open(n,s),n.setCenter(s.position),e.currentEventDate(c.eventDate),e.currentEventName(c.eventTitle),e.currentVenueName(c.eventVenue.name),e.currentVenueAddress(c.eventVenue.address),e.currentPerformerName(u.performerName),I(a)},e.displayVenue=function(){var e=this,r=e.eventIndex,n=i[r];g(n)},e.filterVenues=function(){e.removeFilter(),o.close();var r=e.venueVal().toLowerCase(),t=l,a=i;e.events([]),b(null),e.markers([]);for(var s,c,u=0,m=t.length;m>u;u++)s=t[u],c=s.eventVenue.name.toLowerCase(),r===c&&(e.events.push(s),e.markers.push(a[u]));b(n)},e.removeFilter=function(){e.events(l),e.markers(i),b(null),b(n)},e.openPerformerInfo=function(){e.performerInfo(!0);var r=e.currentPerformerURLs();console.log(r)},e.closePerformerInfo=function(){e.performerInfo(!1),u(),v(),b(n)};var r,n,o,t,a=28.4158,s=-81.2989,l=[],i=[],c=0;$(function(){$.ajaxSetup({error:function(e,r,n){console.log(e),alert("Something went wrong, and it's entirely your fault\nStatus: "+e.status+" - "+r+" "+n)}})});var u=function(){function e(){var e=n.getCenter();google.maps.event.trigger(n,"resize"),n.setCenter(e)}r=new google.maps.Geocoder;var o=new google.maps.LatLng(a,s),t={zoom:10,center:o,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.TERRAIN]},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},panControl:!1};n=new google.maps.Map(document.getElementById("map-canvas"),t),google.maps.event.addDomListener(n,"idle",function(){e()}),google.maps.event.addDomListener(window,"resize",function(){e()})},m=function(e){r.geocode({address:e},function(e,r){r===google.maps.GeocoderStatus.OK?(resultsLocation=e[0].geometry.location,a=resultsLocation.lat(),s=resultsLocation.lng(),n.setCenter(resultsLocation),v()):alert("Geocode was not successful for the following reason: "+r),p(a,s)})},v=function(){var e=new google.maps.LatLng(a,s);t&&t.setMap(null),t=new google.maps.Marker({map:n,position:e,icon:"images/blue-dot.png"})},p=function(e,r){function n(e){f(e)}var o=["concert","music_festival","classical","classical_opera","classical_vocal","classical_orchestral_instrumental"],t={per_page:50,"taxonomies.name":o,lat:e,lon:r,page:c};$.ajax({url:"http://api.seatgeek.com/2/events",dataType:"json",data:t,traditional:!0,success:n})},f=function(r){for(var n=0,o=r.events.length;o>n;n++){var t=r.events[n],a=t.venue,s=function(e){var r=e.split("T"),n=r[0].split("-"),o=r[1].split(":");o[0]=parseInt(o[0]),o[0]>=13?(o[0]-=12,o[3]="p.m."):o[3]="a.m.";var t=n[1]+"/"+n[2]+"/"+n[0],a=o[0]+":"+o[1]+" "+o[3],s=t+" - "+a;return s}(t.datetime_local),i={eventTitle:t.title,eventType:t.type,eventURL:t.url,eventIndex:n};i.eventDate=t.date_tbd?s+" (Date estimated)":t.time_tbd?s+" (Exact time not set)":s,i.eventPerformers=[];for(var u,m=0,v=t.performers.length;v>m;m++)u={},u.performerName=t.performers[m].name,u.performerImgURL=t.performers[m].image,u.eventIndex=n+(50*c-50),u.performerIndex=m,u.performerID=t.performers[m].id,i.eventPerformers.push(u);i.eventVenue={name:a.name,address:a.address+", "+a.display_location+", "+a.postal_code,lat:a.location.lat,lng:a.location.lon},l.push(i)}e.events(l),e.resultsInfo(!0),d(l)},d=function(r){for(var o,t,a,s,l=0+(50*c-50),u=r.length;u>l;l++)t=r[l].eventVenue.lat,a=r[l].eventVenue.lng,s=new google.maps.LatLng(t,a),o=new google.maps.Marker({map:n,position:s,icon:"images/green-dot.png"}),o.eventInfo=new google.maps.InfoWindow({content:"<div id='content'><h1 id='content_header'>"+r[l].eventTitle+"</h1><button onclick=vm.openPerformerInfo()>Get Info</button>"}),o.venueInfo=new google.maps.InfoWindow({content:"<div id='content'><h1 id='content_header'>"+r[l].eventVenue.name+"</h1>"}),google.maps.event.addListener(o,"click",function(){var e=this;g(e)}),i.push(o);e.markers(i)},g=function(e){o?(o.close(),o=e.venueInfo):o=e.venueInfo,e.venueInfo.open(n,e),n.setCenter(e.position)},b=function(r){for(var n=0;n<e.markers().length;n++)e.markers()[n].setMap(r)},I=function(e){var r="2QHXFMFAW2PDSCYKW",n="seatgeek:artist:"+e,o="http://developer.echonest.com/api/v4/artist/profile?",t={api_key:r,id:n,format:"json",bucket:["urls","video","genre"]};$.ajax({url:o,data:t,success:h,dataType:"json",traditional:!0})},h=function(r){if(e.currentPerformerURLs([]),e.currentPerformerGenres([]),e.currentPerformerVideos([]),0===r.response.status.code){var n=r.response.artist,o=n.urls,t=n.genres,a=n.video;e.currentPerformerURLs().push(o),e.currentPerformerGenres(t),e.currentPerformerVideos(a)}};google.maps.event.addDomListener(window,"load",u)}var vm=new MyViewModel;ko.applyBindings(vm);